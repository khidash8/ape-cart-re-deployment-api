"use strict";(self.webpackChunkapi=self.webpackChunkapi||[]).push([[9541],{69541:(z,g,s)=>{s.d(g,{ProtectedEditPage:()=>G});var t=s(74081),D=s(27279),E=s(93415),l=s(10701),v=s(32370),A=s(48102),I=s(23298),O=s(74577),h=s(12881),T=s(39708),B=s(73354),L=s(27875),d=s(74758),U=s(79213),_=s(94050),W=s(76827),K=s(53532),j=s(71563),i=s(61020),f=s(40464),C=s(51447),$=s(47533),y=s(47853),Q=s(42816),Y=s(87137),H=s(66947),S=s(29679),ds=s(15816),rs=s(97442),ls=s(13576),Ps=s(87830),Ms=s(47184),es=s(364),Ds=s(59461),Os=s(49204),ms=s(74919),Rs=s(29206),vs=s(98934),As=s(43433),hs=s(75719),Ls=s(8175),Cs=s(6078),cs=s(51943),gs=s(55783),Is=s(92249),Ts=s(41942),Bs=s(22919),Us=s(53915),Ws=s(75041),Ks=s(30200),fs=s(91379),xs=s(33299),us=s(33409),js=s(63645),ys=s(7988),Ss=s(7055),ps=s(26757),Ns=s(58311),Zs=s(29510),Fs=s(16946),zs=s(10124),$s=s(69530),Qs=s(86961),Ys=s(51527),Hs=s(19764),Js=s(42982),Vs=s(26126),Xs=s(64797),Gs=s(85811),bs=s(10131),ks=s(63799);const J=({disabled:r,role:n,values:m,errors:a,onChange:R,onBlur:c})=>{const{formatMessage:o}=(0,i.Z)();return(0,t.jsx)(E.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(l.k,{justifyContent:"space-between",children:[(0,t.jsxs)(E.x,{children:[(0,t.jsx)(E.x,{children:(0,t.jsx)(v.Z,{fontWeight:"bold",children:n?n.name:o({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(E.x,{children:(0,t.jsx)(v.Z,{textColor:"neutral500",variant:"pi",children:n?n.description:o({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(A.z,{disabled:!0,variant:"secondary",children:o({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:n.usersCount})})]}),(0,t.jsxs)(I.r,{gap:4,children:[(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(h.o,{disabled:r,name:"name",error:a.name&&o({id:a.name}),label:o({id:"global.name",defaultMessage:"Name"}),onChange:R,onBlur:c,required:!0,value:m.name||""})}),(0,t.jsx)(O.P,{col:6,children:(0,t.jsx)(T.g,{disabled:r,label:o({id:"global.description",defaultMessage:"Description"}),id:"description",error:a.name&&o({id:a.name}),onChange:R,onBlur:c,children:m.description||""})})]})]})})},V=y.Ry().shape({name:y.Z_().required(_.I0.required)}),X=()=>{const r=(0,_.lm)(),{formatMessage:n}=(0,i.Z)(),a=(0,C.$B)("/settings/roles/:id")?.params.id,{put:R,get:c}=(0,_.kY)(),[o,p]=D.useState(!1),x=D.useRef(null),{lockApp:b,unlockApp:k}=(0,_.o1)(),{trackUsage:w}=(0,_.rS)(),{formatAPIError:q}=(0,_.So)(),{isLoading:ss,data:N}=(0,f.useQuery)(["permissions",a],async()=>{const{data:{data:M}}=await c("/admin/permissions",{params:{role:a}});return M},{cacheTime:0}),{roles:ts,isLoading:Z,refetch:as}=(0,Y.u)({id:a},{cacheTime:0}),P=ts[0]??{},{permissions:_s,isLoading:ns}=(0,S.u)({id:a??null},{cacheTime:0}),os=async M=>{try{b?.(),p(!0);const{permissionsToSend:e,didUpdateConditions:u}=x.current?.getPermissions()??{};await R(`/admin/roles/${a}`,M),P.code!=="strapi-super-admin"&&(await R(`/admin/roles/${a}/permissions`,{permissions:e}),u&&w("didUpdateConditions")),x.current?.setFormAfterSubmit(),await as(),r({type:"success",message:{id:"notification.success.saved"}})}catch(e){e instanceof K.d7&&r({type:"warning",message:q(e)})}finally{p(!1),k?.()}},F=!Z&&P.code==="strapi-super-admin";return(0,t.jsxs)(B.o,{children:[(0,t.jsx)(_.SL,{name:"Roles"}),(0,t.jsx)(j.J9,{enableReinitialize:!0,initialValues:{name:P.name??"",description:P.description??""},onSubmit:os,validationSchema:V,validateOnChange:!1,children:({handleSubmit:M,values:e,errors:u,handleChange:Es,handleBlur:is})=>(0,t.jsxs)("form",{onSubmit:M,children:[(0,t.jsx)(L.T,{primaryAction:(0,t.jsx)(l.k,{gap:2,children:(0,t.jsx)(A.z,{type:"submit",disabled:P.code==="strapi-super-admin",onClick:M,loading:o,size:"L",children:n({id:"global.save",defaultMessage:"Save"})})}),title:n({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(U.r,{as:$.NavLink,startIcon:(0,t.jsx)(W.Z,{}),to:"/settings/roles",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(d.D,{children:(0,t.jsxs)(l.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(J,{disabled:F,errors:u,values:e,onChange:Es,onBlur:is,role:P}),!ss&&!Z&&!ns&&N?(0,t.jsx)(E.x,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(S.P,{isFormDisabled:F,permissions:_s,ref:x,layout:N})}):(0,t.jsx)(E.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(_.dO,{})})]})})]})})]})},G=()=>{const r=(0,Q.f)(H.s),{isLoading:n,allowedActions:{canRead:m,canUpdate:a}}=(0,_.ss)(r.settings?.roles);return n?(0,t.jsx)(_.dO,{}):!m&&!a?(0,t.jsx)(C.l_,{to:"/"}):(0,t.jsx)(X,{})}},87137:(z,g,s)=>{s.d(g,{u:()=>v});var t=s(27279),D=s(94050),E=s(61020),l=s(40464);const v=(A={},I={})=>{const{id:O="",...h}=A,{get:T}=(0,D.kY)(),{locale:B}=(0,E.Z)(),L=(0,D.Xe)(B,{sensitivity:"base"}),{data:d,error:U,isError:_,isLoading:W,refetch:K}=(0,l.useQuery)(["roles",O,h],async()=>{const{data:i}=await T(`/admin/roles/${O??""}`,{params:h});return i},I);return{roles:t.useMemo(()=>{let i=[];return d&&(Array.isArray(d.data)?i=d.data:i=[d.data]),[...i].sort((f,C)=>L.compare(f.name,C.name))},[d,L]),error:U,isError:_,isLoading:W,refetch:K}}}}]);
